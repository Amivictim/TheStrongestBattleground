local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local localPlayer = Players.LocalPlayer
repeat task.wait() until localPlayer and localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart")

local character = localPlayer.Character
local rootPart = character:FindFirstChild("HumanoidRootPart")
local camera = workspace.CurrentCamera

local mainUsername = mainuser
local mainPosition = Vector3.new(361, 440, 428)
local otherPosition = Vector3.new(359, 440, 425)
local maxDistance = 3

local characterChanged = false

if not characterChanged then
    characterChanged = true
    local args = {
        [1] = {
            ["Goal"] = "Change Character",
            ["Character"] = "Cyborg"
        }
    }
    game:GetService("Players").LocalPlayer.Character.Communicate:FireServer(unpack(args))
end

local function keepCharacterInPosition(targetPosition)
    if rootPart and (rootPart.Position - targetPosition).Magnitude > maxDistance then
        rootPart.CFrame = CFrame.new(targetPosition)
    end
end

local function findClosestPlayer()
    local closestPlayer = nil
    local closestDistance = math.huge

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (rootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            if distance < closestDistance then
                closestDistance = distance
                closestPlayer = player
            end
        end
    end

    return closestPlayer
end

local function rotateToClosestPlayer()
    local closestPlayer = findClosestPlayer()
    if closestPlayer and closestPlayer.Character then
        local targetPos = closestPlayer.Character.HumanoidRootPart.Position
        local lookAtCFrame = CFrame.lookAt(rootPart.Position, Vector3.new(targetPos.X, rootPart.Position.Y, targetPos.Z))

        rootPart.CFrame = lookAtCFrame
        camera.CFrame = lookAtCFrame
    end
end

local function fireEvents()
    local args1 = {
        [1] = {
            ["Mobile"] = true,
            ["Goal"] = "LeftClick"
        }
    }
    game:GetService("Players").LocalPlayer.Character.Communicate:FireServer(unpack(args1))

    task.wait(0.1)

    local skills = {"Blitz Shot", "Jet Dive", "Ignition Burst", "Machine Gun Blows"}

    for _, skill in ipairs(skills) do
        local tool = localPlayer.Backpack:FindFirstChild(skill)
        if tool then
            local args2 = {
                [1] = {
                    ["Tool"] = tool,
                    ["Goal"] = "Console Move"
                }
            }
            game:GetService("Players").LocalPlayer.Character.Communicate:FireServer(unpack(args2))
        end
        task.wait(0.1)
    end
end

task.spawn(function()
    while true do
        if localPlayer.Name == mainUsername then
            keepCharacterInPosition(mainPosition)
            rotateToClosestPlayer()
            fireEvents()
        else
            keepCharacterInPosition(otherPosition)
        end
        task.wait(0.1)
    end
end)

RunService.Heartbeat:Connect(function()
    if localPlayer.Name == mainUsername then
        keepCharacterInPosition(mainPosition)
    else
        keepCharacterInPosition(otherPosition)
    end
end)
